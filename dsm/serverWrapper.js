#!/usr/bin/env node
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=184)}({0:function(t,e){t.exports=require("path")},1:function(t,e){t.exports=require("fs")},10:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(5));let i;void 0!==i&&null!==i||(i=new(0,n(24).LocalStorage)(r.default.resolve(o.InstallationDir()+"/dsm/.storage")));e.default=i},11:function(t,e){t.exports=require("assert")},15:function(t,e,n){"use strict";var r=n(1);t.exports=function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Object)var e={__proto__:t.__proto__};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}(r)},16:function(t,e){t.exports=function(){var t,e=Array.prototype.slice.call(arguments),n=null;"object"==typeof e[0]?(n=e.shift(),"string"==typeof(t=e.shift())&&(t=n[t])):t=e.shift();return function(r){t.apply(n,e.concat(r))}}},184:function(t,e,n){"use strict";var r=a(n(0)),o=a(n(10)),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(5)),c=a(n(185)),s=a(n(186)),u=a(n(189));function a(t){return t&&t.__esModule?t:{default:t}}var l=new(n(4).EventEmitter.EventEmitter);c.default.RegisterToWrapperEmitter(l),s.default.RegisterToWrapperEmitter(l),console.log("-----Dirty Server Manager-----"),console.log("DSM: Server Wrapper Initilized on pid: "+process.pid),o.default.setItem("WrapperPid",process.pid),n(190).lock(r.default.resolve(i.InstallationDir()+"/dsm/config.ini"),{},function(t){}),(0,u.default)(l),l.on("crash",t=>{console.log("Detected server crash, waiting 7 seconds"),t.write("/save\n"),setTimeout(()=>{t.destroy(),setTimeout(()=>{console.log("processing events..."),(0,u.default)(l),console.log("Restarted")},7e3)},7e3)}),l.on("shutdown",t=>{t.destroy()}),process.on("beforeExit",()=>{console.log("DSM: Closing wrapper GoodBye!"),o.default.clear(),process.exit(0)})},185:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s(n(9)),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(5)),i=s(n(0)),c=s(n(8));function s(t){return t&&t.__esModule?t:{default:t}}e.default={RegisterToWrapperEmitter:t=>{let e;t.on("spawned",function(n){(e=r.default.createServer(e=>{const r=t=>{e.write(t)},o=()=>{e.write("Shutdow succesfull"),e.end()},i=()=>{console.log("Shutting down connected client"),e.end()};t.on("exit",i),e.on("end",()=>{t.removeListener("data",r),t.removeListener("exit",i),t.removeListener("status",r),t.removeListener("shutdown",o)}),e.on("data",function(e){"ATTACH"===e.toString()?t.on("data",r):"/status"===e.toString()?(console.log("STATUS COMMAND"),n.write(e+"\n"),t.on("status",r)):"/stop"===e.toString()?(console.log("SHUTDOWN COMMAND"),n.write(e+"\n"),t.on("shutdown",o)):(console.log("NORMAL"),n.write(e+"\n"),t.on("data",r))})})).on("error",t=>{console.log(t)}),e.listen(o.cleanPipeName(i.default.resolve(c.default.tmpdir()+"/dsm.sock")),()=>{n.write("DSM IPC Initialized.\n")})}),t.on("exit",()=>{console.log("CLOSING IPC SERVER"),e.close()})}}},186:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(33)),o=i(n(187));function i(t){return t&&t.__esModule?t:{default:t}}n(97);let c=!0,s=!1,u=!1;e.default={RegisterToWrapperEmitter:t=>{t.on("startup",function(e){e.write("/echo DSM: Initilized Status Checker, checking every "+(0,o.default)(r.default.STATUS_INTERVAL_MS)+"\n"),u=setInterval(()=>{console.log("INTERVAL"),c=!1,e.write("/status\n"),s=setTimeout(()=>{console.log("/FAILED TO GET STATUS"),t.emit("crash",e)},3e4)},r.default.STATUS_INTERVAL_MS)}),t.on("status",function(t){c=!0,!1!==s&&clearTimeout(s),s=!1}),t.on("exit",()=>{c=!0,!1!==s&&clearTimeout(s),s=!1,!1!==u&&clearTimeout(u),u=!1})}}},187:function(t,e,n){"use strict";const r=n(188),o=(t,e)=>1===e?t:t+"s";t.exports=((t,e)=>{if(!Number.isFinite(t))throw new TypeError("Expected a finite number");if(e=e||{},t<1e3){const n="number"==typeof e.msDecimalDigits?e.msDecimalDigits:0;return(n?t.toFixed(n):Math.ceil(t))+(e.verbose?" "+o("millisecond",Math.ceil(t)):"ms")}const n=[],i=(t,r,i,c)=>{if(0===t)return;const s=e.verbose?" "+o(r,t):i;n.push((c||t)+s)},c=r(t);if(i(Math.trunc(c.days/365),"year","y"),i(c.days%365,"day","d"),i(c.hours,"hour","h"),i(c.minutes,"minute","m"),e.compact)return i(c.seconds,"second","s"),"~"+n[0];const s=t/1e3%60,u="number"==typeof e.secDecimalDigits?e.secDecimalDigits:1,a=s.toFixed(u);return i(s,"second","s",e.keepDecimalsOnWholeSeconds?a:a.replace(/\.0+$/,"")),n.join(" ")})},188:function(t,e,n){"use strict";t.exports=function(t){if("number"!=typeof t)throw new TypeError("Expected a number");var e=t>0?Math.floor:Math.ceil;return{days:e(t/864e5),hours:e(t/36e5)%24,minutes:e(t/6e4)%60,seconds:e(t/1e3)%60,milliseconds:e(t)%1e3}}},189:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(5)),o=function(t){return t&&t.__esModule?t:{default:t}}(n(0));var i=n(97);e.default=(t=>{const e=i.spawn(o.default.resolve(r.InstallationDir()+"/avorion/bin/AvorionServer.exe"),["--galaxy-name","avorion_galaxy","--admin","avorion_admin"],{cwd:process.cwd()+"\\avorion"});t.emit("spawned",e),e.write("DSM IPC Initializing...\n"),e.on("error",t=>{console.log(t)}),e.on("data",function(n){console.log(n.replace(/(\u001b|\[0K|\[\?25l|\[\?25h|\[\?)/gm,"")),t.emit("data",n),n.includes("Memory used by scripts")&&t.emit("status",n),n.includes("Server startup complete")&&t.emit("startup",e),n.includes("Server shutdown")&&t.emit("shutdown",e)}),e.on("error",t=>{console.log("Server Error:",t)}),e.on("exit",n=>{console.log("exit",n),0===n?t.emit("exit"):1===n&&(t.emit("exit"),t.emit("crash",e))})})},190:function(t,e,n){var r=n(1),o="wx";if(process.version.match(/^v0\.[0-6]/)){var i=n(20);o=i.O_TRUNC|i.O_CREAT|i.O_WRONLY|i.O_EXCL}var c,s=n(8);e.filetime="ctime","win32"==s.platform()&&(e.filetime="mtime");var u=n(3);c=u.debuglog?u.debuglog("LOCKFILE"):/\blockfile\b/i.test(process.env.NODE_DEBUG)?function(){var t=u.format.apply(u,arguments);console.error("LOCKFILE %d %s",process.pid,t)}:function(){};var a={};n(191)(function(){c("exit listener"),Object.keys(a).forEach(e.unlockSync)}),/^v0\.[0-8]\./.test(process.version)&&(c("uncaughtException, version = %s",process.version),process.on("uncaughtException",function t(n){if(c("uncaughtException"),!process.listeners("uncaughtException").filter(function(e){return e!==t}).length){try{Object.keys(a).forEach(e.unlockSync)}catch(t){}throw process.removeListener("uncaughtException",t),n}})),e.unlock=function(t,e){c("unlock",t),delete a[t],r.unlink(t,function(t){e&&e()})},e.unlockSync=function(t){c("unlockSync",t);try{r.unlinkSync(t)}catch(t){}delete a[t]},e.check=function(t,n,o){"function"==typeof n&&(o=n,n={}),c("check",t,n),r.open(t,"r",function(t,i){return t?"ENOENT"!==t.code?o(t):o(null,!1):n.stale?void r.fstat(i,function(t,c){if(t)return r.close(i,function(e){return o(t)});r.close(i,function(t){var r=Date.now()-c[e.filetime].getTime();return o(t,r<=n.stale)})}):r.close(i,function(t){return o(t,!0)})})},e.checkSync=function(t,n){if(c("checkSync",t,n=n||{}),n.wait)throw new Error("opts.wait not supported sync for obvious reasons");try{var o=r.openSync(t,"r")}catch(t){if("ENOENT"!==t.code)throw t;return!1}if(!n.stale){try{r.closeSync(o)}catch(t){}return!0}if(n.stale){try{var i=r.fstatSync(o)}finally{r.closeSync(o)}return Date.now()-i[e.filetime].getTime()<=n.stale}};var l=1;function f(t,n,r,o){if(c("notStale",n,r),"number"!=typeof r.wait||r.wait<=0)return c("notStale, wait is not a number"),o(t);var i=Date.now(),s=r.start||i,u=s+r.wait;if(u<=i)return o(t);c("now=%d, wait until %d (delta=%d)",s,u,u-s);var a=Math.min(u-s,r.pollPeriod||100);setTimeout(function(){c("notStale, polling",n,r),e.lock(n,r,o)},a)}function p(t,n,r){if("number"==typeof n.retries&&n.retries>0){var o=n.retries-1;return c("retryThrow",t,n,o),n.retries=o,e.lockSync(t,n)}throw r}e.lock=function(t,n,i){if("function"==typeof n&&(i=n,n={}),n.req=n.req||l++,c("lock",t,n),n.start=n.start||Date.now(),"number"==typeof n.retries&&n.retries>0){c("has retries",n.retries);var s=n.retries;n.retries=0,i=function(r){return function o(i,u){if(c("retry-mutated callback"),!i||(s-=1)<0)return r(i,u);function a(){n.start=Date.now(),c("retrying",n.start),e.lock(t,n,o)}c("lock retry",t,n),n.retryWait?setTimeout(a,n.retryWait):a()}}(i)}r.open(t,o,function(o,s){return o?(c("failed to acquire lock",o),"EEXIST"!==o.code?(c("not EEXIST error",o),i(o)):n.stale?function t(n,o,i,s,u){r.stat(o,function(a,l){if(a)return"ENOENT"===a.code?(i.stale=!1,c("lock stale enoent retry",o,i),void e.lock(o,i,u)):u(a);var p=Date.now()-l[e.filetime].getTime();if(p<=i.stale)return f(n,o,i,u);c("lock stale",o,i),s?e.unlock(o,function(t){if(t)return u(t);c("lock stale retry",o,i),r.link(o+".STALE",o,function(t){r.unlink(o+".STALE",function(){u(t)})})}):(c("acquire .STALE file lock",i),e.lock(o+".STALE",i,function(e){if(e)return u(e);t(n,o,i,!0,u)}))})}(o,t,n,!1,i):f(o,t,n,i)):(c("locked",t,s),a[t]=s,r.close(s,function(){return i()}))}),c("lock return")},e.lockSync=function(t,n){if((n=n||{}).req=n.req||l++,c("lockSync",t,n),n.wait||n.retryWait)throw new Error("opts.wait not supported sync for obvious reasons");try{var i=r.openSync(t,o);a[t]=i;try{r.closeSync(i)}catch(t){}return void c("locked sync!",t,i)}catch(o){if("EEXIST"!==o.code)return p(t,n,o);if(n.stale){var s=r.statSync(t)[e.filetime].getTime();!(s%1e3)&&n.stale%1e3&&(n.stale=1e3*Math.ceil(n.stale/1e3));var u=Date.now()-s;if(u>n.stale)return c("lockSync stale",t,n,u),e.unlockSync(t),e.lockSync(t,n)}return c("failed to lock",t,n,o),p(t,n,o)}}},191:function(t,e,n){var r,o=n(11),i=n(192),c=n(4);function s(){l&&(l=!1,i.forEach(function(t){try{process.removeListener(t,a[t])}catch(t){}}),process.emit=d,process.reallyExit=p,r.count-=1)}function u(t,e,n){r.emitted[t]||(r.emitted[t]=!0,r.emit(t,e,n))}"function"!=typeof c&&(c=c.EventEmitter),process.__signal_exit_emitter__?r=process.__signal_exit_emitter__:((r=process.__signal_exit_emitter__=new c).count=0,r.emitted={}),r.infinite||(r.setMaxListeners(1/0),r.infinite=!0),t.exports=function(t,e){o.equal(typeof t,"function","a callback must be provided for exit handler"),!1===l&&f();var n="exit";e&&e.alwaysLast&&(n="afterexit");return r.on(n,t),function(){r.removeListener(n,t),0===r.listeners("exit").length&&0===r.listeners("afterexit").length&&s()}},t.exports.unload=s;var a={};i.forEach(function(t){a[t]=function(){process.listeners(t).length===r.count&&(s(),u("exit",null,t),u("afterexit",null,t),process.kill(process.pid,t))}}),t.exports.signals=function(){return i},t.exports.load=f;var l=!1;function f(){l||(l=!0,r.count+=1,i=i.filter(function(t){try{return process.on(t,a[t]),!0}catch(t){return!1}}),process.emit=y,process.reallyExit=h)}var p=process.reallyExit;function h(t){process.exitCode=t||0,u("exit",process.exitCode,null),u("afterexit",process.exitCode,null),p.call(process,process.exitCode)}var d=process.emit;function y(t,e){if("exit"===t){void 0!==e&&(process.exitCode=e);var n=d.apply(this,arguments);return u("exit",process.exitCode,null),u("afterexit",process.exitCode,null),n}return d.apply(this,arguments)}},192:function(t,e){t.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],"win32"!==process.platform&&t.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),"linux"===process.platform&&t.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")},20:function(t,e){t.exports=require("constants")},24:function(t,e,n){(function(){var t,r,o,i,c,s,u,a,l,f,p,h,d,y=function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},m={}.hasOwnProperty;h=n(0),p=n(1),f=n(4),d=n(25).sync,s=function(t){var e,n,r,o,i;for(i=[],e=0,n=(o=p.readdirSync(t)).length;e<n;e++)r=o[e],i.push(a(h.join(t,r)));return i},a=function(t){return p.statSync(t).isDirectory()?(s(t),p.rmdirSync(t)):p.unlinkSync(t)},u=function(t){return""===t?"---.EMPTY_STRING.---":t.toString()},i=function(t){function e(t){this.message=null!=t?t:"Unknown error.",null!=Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}return y(e,t),e.prototype.toString=function(){return this.name+": "+this.message},e}(Error),c=function(){return function(t,e,n,r,o){this.key=t,this.oldValue=e,this.newValue=n,this.url=r,this.storageArea=null!=o?o:"localStorage"}}(),o=function(){return function t(e,n){if(this.key=e,this.index=n,!(this instanceof t))return new t(this.key,this.index)}}(),l=function(){var t;return(t=function(){}).prototype=Object.create(null),new t},r=function(t){var e;function n(t,r){return this._location=t,this.quota=null!=r?r:5242880,this instanceof n?(this._location=h.resolve(this._location),null!=e[this._location]?e[this._location]:(this.length=0,this._bytesInUse=0,this._keys=[],this._metaKeyMap=l(),this._eventUrl="pid:"+process.pid,this._init(),this._QUOTA_EXCEEDED_ERR=i,e[this._location]=this,e[this._location])):new n(this._location,this.quota)}return y(n,t),e={},n.prototype._init=function(){var t,e,n,r,i,c,s,u,a,l,f;try{if(null!=(f=p.statSync(this._location))&&!f.isDirectory())throw new Error("A file exists at the location '"+this._location+"' when trying to create/open localStorage");for(this._bytesInUse=0,this.length=0,n=p.readdirSync(this._location),u=s=0,l=n.length;s<l;u=++s)a=n[u],e=decodeURIComponent(a),this._keys.push(e),t=new o(a,u),this._metaKeyMap[e]=t,null!=(null!=(f=this._getStat(a))?f.size:void 0)&&(t.size=f.size,this._bytesInUse+=f.size);this.length=n.length}catch(i){if("ENOENT"!==(r=i).code)throw r;try{p.mkdirSync(this._location)}catch(c){if("EEXIST"!==(r=c).code)throw r}}},n.prototype.setItem=function(t,e){var n,r,s,a,l,p,y,m,v,S;if(m=null,(l=f.EventEmitter.listenerCount(this,"storage"))&&(m=this.getItem(t)),t=u(t),n=encodeURIComponent(t),a=h.join(this._location,n),S=(v=e.toString()).length,y=(s=!!(p=this._metaKeyMap[t]))?p.size:0,this._bytesInUse-y+S>this.quota)throw new i;if(d(a,v,"utf8"),s||((p=new o(n,this._keys.push(t)-1)).size=S,this._metaKeyMap[t]=p,this.length+=1,this._bytesInUse+=S),l)return r=new c(t,m,e,this._eventUrl),this.emit("storage",r)},n.prototype.getItem=function(t){var e,n;return t=u(t),(n=this._metaKeyMap[t])?(e=h.join(this._location,n.key),p.readFileSync(e,"utf8")):null},n.prototype._getStat=function(t){var e;t=u(t),e=h.join(this._location,encodeURIComponent(t));try{return p.statSync(e)}catch(t){return null}},n.prototype.removeItem=function(t){var e,n,r,o,i,s,l,p;if(t=u(t),s=this._metaKeyMap[t]){for(o in l=null,(r=f.EventEmitter.listenerCount(this,"storage"))&&(l=this.getItem(t)),delete this._metaKeyMap[t],this.length-=1,this._bytesInUse-=s.size,n=h.join(this._location,s.key),this._keys.splice(s.index,1),p=this._metaKeyMap)p[o],(i=this._metaKeyMap[o]).index>s.index&&(i.index-=1);if(a(n),r)return e=new c(t,l,null,this._eventUrl),this.emit("storage",e)}},n.prototype.key=function(t){return this._keys[t]},n.prototype.clear=function(){var t;if(s(this._location),this._metaKeyMap=l(),this._keys=[],this.length=0,this._bytesInUse=0,f.EventEmitter.listenerCount(this,"storage"))return t=new c(null,null,null,this._eventUrl),this.emit("storage",t)},n.prototype._getBytesInUse=function(){return this._bytesInUse},n.prototype._deleteLocation=function(){return delete e[this._location],a(this._location),this._metaKeyMap={},this._keys=[],this.length=0,this._bytesInUse=0},n}(f.EventEmitter),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return y(e,r),e.prototype.setItem=function(t,n){var r;return r=JSON.stringify(n),e.__super__.setItem.call(this,t,r)},e.prototype.getItem=function(t){return JSON.parse(e.__super__.getItem.call(this,t))},e}(),e.LocalStorage=r,e.JSONStorage=t,e.QUOTA_EXCEEDED_ERR=i}).call(this)},25:function(t,e,n){"use strict";(function(e){t.exports=function(t,e,n,i){n instanceof Function&&(i=n,n=null);n||(n={});r.realpath(t,function(s,a){!function(t,e,n,i){var s=u(t);return n.mode&&n.chown?a():r.stat(t,function(t,e){return t||!e?a():((n=c({},n)).mode||(n.mode=e.mode),!n.chown&&process.getuid&&(n.chown={uid:e.uid,gid:e.gid}),a())});function a(){o([[l,s,e,n.mode,n.encoding||"utf8"],n.chown&&[r,r.chown,s,n.chown.uid,n.chown.gid],n.mode&&[r,r.chmod,s,n.mode],[r,r.rename,s,t]],function(t){t?r.unlink(s,function(){i(t)}):i()})}function l(t,e,o,i,c){r.open(t,"w",n.mode,function(t,n){return t?c(t):Buffer.isBuffer(e)?r.write(n,e,0,e.length,0,o):null!=e?r.write(n,String(e),0,String(i),o):o();function o(t){if(t)return c(t);r.fsync(n,function(t){if(t)return c(t);r.close(n,c)})}})}}(a||t,e,n,i)})},t.exports.sync=function(t,e,n){n||(n={});try{t=r.realpathSync(t)}catch(t){}var o=u(t);try{if(!n.mode||!n.chown)try{var i=r.statSync(t);(n=c({},n)).mode||(n.mode=i.mode),!n.chown&&process.getuid&&(n.chown={uid:i.uid,gid:i.gid})}catch(t){}var s=r.openSync(o,"w",n.mode);Buffer.isBuffer(e)?r.writeSync(s,e,0,e.length,0):null!=e&&r.writeSync(s,String(e),0,String(n.encoding||"utf8")),r.fsyncSync(s),r.closeSync(s),n.chown&&r.chownSync(o,n.chown.uid,n.chown.gid),n.mode&&r.chmodSync(o,n.mode),r.renameSync(o,t)}catch(t){try{r.unlinkSync(o)}catch(t){}throw t}},t.exports._getTmpname=u;var r=n(26),o=n(29).chain,i=n(32),c=Object.assign||n(3)._extend,s=0;function u(t){return t+"."+i(e).hash(String(process.pid)).hash(String(++s)).result()}}).call(this,"/index.js")},26:function(t,e,n){var r=n(1),o=n(27),i=n(28),c=[],s=n(3);var u=function(){};function a(t){o(t),t.gracefulify=a,t.FileReadStream=d,t.FileWriteStream=y,t.createReadStream=function(t,e){return new d(t,e)},t.createWriteStream=function(t,e){return new y(t,e)};var e=t.readFile;t.readFile=function(t,n,r){"function"==typeof n&&(r=n,n=null);return function t(n,r,o){return e(n,r,function(e){!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?("function"==typeof o&&o.apply(this,arguments),f()):l([t,[n,r,o]])})}(t,n,r)};var n=t.writeFile;t.writeFile=function(t,e,r,o){"function"==typeof r&&(o=r,r=null);return function t(e,r,o,i){return n(e,r,o,function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?("function"==typeof i&&i.apply(this,arguments),f()):l([t,[e,r,o,i]])})}(t,e,r,o)};var r=t.appendFile;r&&(t.appendFile=function(t,e,n,o){"function"==typeof n&&(o=n,n=null);return function t(e,n,o,i){return r(e,n,o,function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?("function"==typeof i&&i.apply(this,arguments),f()):l([t,[e,n,o,i]])})}(t,e,n,o)});var c=t.readdir;function s(e){return c.apply(t,e)}if(t.readdir=function(t,e,n){var r=[t];"function"!=typeof e?r.push(e):n=e;return r.push(function(t,e){e&&e.sort&&e.sort(),!t||"EMFILE"!==t.code&&"ENFILE"!==t.code?("function"==typeof n&&n.apply(this,arguments),f()):l([s,[r]])}),s(r)},"v0.8"===process.version.substr(0,4)){var u=i(t);d=u.ReadStream,y=u.WriteStream}var p=t.ReadStream;d.prototype=Object.create(p.prototype),d.prototype.open=function(){var t=this;v(t.path,t.flags,t.mode,function(e,n){e?(t.autoClose&&t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n),t.read())})};var h=t.WriteStream;function d(t,e){return this instanceof d?(p.apply(this,arguments),this):d.apply(Object.create(d.prototype),arguments)}function y(t,e){return this instanceof y?(h.apply(this,arguments),this):y.apply(Object.create(y.prototype),arguments)}y.prototype=Object.create(h.prototype),y.prototype.open=function(){var t=this;v(t.path,t.flags,t.mode,function(e,n){e?(t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n))})},t.ReadStream=d,t.WriteStream=y;var m=t.open;function v(t,e,n,r){return"function"==typeof n&&(r=n,n=null),function t(e,n,r,o){return m(e,n,r,function(i,c){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?("function"==typeof o&&o.apply(this,arguments),f()):l([t,[e,n,r,o]])})}(t,e,n,r)}return t.open=v,t}function l(t){u("ENQUEUE",t[0].name,t[1]),c.push(t)}function f(){var t=c.shift();t&&(u("RETRY",t[0].name,t[1]),t[0].apply(null,t[1]))}s.debuglog?u=s.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(u=function(){var t=s.format.apply(s,arguments);t="GFS4: "+t.split(/\n/).join("\nGFS4: "),console.error(t)}),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){u(c),n(11).equal(c.length,0)}),t.exports=a(n(15)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&(t.exports=a(r)),t.exports.close=r.close=function(t){return function(e,n){return t.call(r,e,function(t){t||f(),"function"==typeof n&&n.apply(this,arguments)})}}(r.close),t.exports.closeSync=r.closeSync=function(t){return function(e){var n=t.apply(r,arguments);return f(),n}}(r.closeSync)},27:function(t,e,n){var r=n(15),o=n(20),i=process.cwd,c=null,s=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return c||(c=i.call(process)),c};try{process.cwd()}catch(t){}var u=process.chdir;function a(t){return t?function(e,n,o){return t.call(r,e,n,function(t){y(t)&&(t=null),o&&o.apply(this,arguments)})}:t}function l(t){return t?function(e,n){try{return t.call(r,e,n)}catch(t){if(!y(t))throw t}}:t}function f(t){return t?function(e,n,o,i){return t.call(r,e,n,o,function(t){y(t)&&(t=null),i&&i.apply(this,arguments)})}:t}function p(t){return t?function(e,n,o){try{return t.call(r,e,n,o)}catch(t){if(!y(t))throw t}}:t}function h(t){return t?function(e,n){return t.call(r,e,function(t,e){if(!e)return n.apply(this,arguments);e.uid<0&&(e.uid+=4294967296),e.gid<0&&(e.gid+=4294967296),n&&n.apply(this,arguments)})}:t}function d(t){return t?function(e){var n=t.call(r,e);return n.uid<0&&(n.uid+=4294967296),n.gid<0&&(n.gid+=4294967296),n}:t}function y(t){return!t||("ENOSYS"===t.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==t.code&&"EPERM"!==t.code))}process.chdir=function(t){c=null,u.call(process,t)},t.exports=function(t){o.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(t){t.lchmod=function(e,n,r){t.open(e,o.O_WRONLY|o.O_SYMLINK,n,function(e,o){e?r&&r(e):t.fchmod(o,n,function(e){t.close(o,function(t){r&&r(e||t)})})})},t.lchmodSync=function(e,n){var r,i=t.openSync(e,o.O_WRONLY|o.O_SYMLINK,n),c=!0;try{r=t.fchmodSync(i,n),c=!1}finally{if(c)try{t.closeSync(i)}catch(t){}else t.closeSync(i)}return r}}(t);t.lutimes||function(t){o.hasOwnProperty("O_SYMLINK")?(t.lutimes=function(e,n,r,i){t.open(e,o.O_SYMLINK,function(e,o){e?i&&i(e):t.futimes(o,n,r,function(e){t.close(o,function(t){i&&i(e||t)})})})},t.lutimesSync=function(e,n,r){var i,c=t.openSync(e,o.O_SYMLINK),s=!0;try{i=t.futimesSync(c,n,r),s=!1}finally{if(s)try{t.closeSync(c)}catch(t){}else t.closeSync(c)}return i}):(t.lutimes=function(t,e,n,r){r&&process.nextTick(r)},t.lutimesSync=function(){})}(t);t.chown=f(t.chown),t.fchown=f(t.fchown),t.lchown=f(t.lchown),t.chmod=a(t.chmod),t.fchmod=a(t.fchmod),t.lchmod=a(t.lchmod),t.chownSync=p(t.chownSync),t.fchownSync=p(t.fchownSync),t.lchownSync=p(t.lchownSync),t.chmodSync=l(t.chmodSync),t.fchmodSync=l(t.fchmodSync),t.lchmodSync=l(t.lchmodSync),t.stat=h(t.stat),t.fstat=h(t.fstat),t.lstat=h(t.lstat),t.statSync=d(t.statSync),t.fstatSync=d(t.fstatSync),t.lstatSync=d(t.lstatSync),t.lchmod||(t.lchmod=function(t,e,n){n&&process.nextTick(n)},t.lchmodSync=function(){});t.lchown||(t.lchown=function(t,e,n,r){r&&process.nextTick(r)},t.lchownSync=function(){});"win32"===s&&(t.rename=function(e){return function(n,r,o){var i=Date.now(),c=0;e(n,r,function s(u){if(u&&("EACCES"===u.code||"EPERM"===u.code)&&Date.now()-i<6e4)return setTimeout(function(){t.stat(r,function(t,i){t&&"ENOENT"===t.code?e(n,r,s):o(u)})},c),void(c<100&&(c+=10));o&&o(u)})}}(t.rename));t.read=function(e){return function(n,r,o,i,c,s){var u;if(s&&"function"==typeof s){var a=0;u=function(l,f,p){if(l&&"EAGAIN"===l.code&&a<10)return a++,e.call(t,n,r,o,i,c,u);s.apply(this,arguments)}}return e.call(t,n,r,o,i,c,u)}}(t.read),t.readSync=function(e){return function(n,r,o,i,c){for(var s=0;;)try{return e.call(t,n,r,o,i,c)}catch(t){if("EAGAIN"===t.code&&s<10){s++;continue}throw t}}}(t.readSync)}},28:function(t,e,n){var r=n(6).Stream;t.exports=function(t){return{ReadStream:function e(n,o){if(!(this instanceof e))return new e(n,o);r.call(this);var i=this;this.path=n;this.fd=null;this.readable=!0;this.paused=!1;this.flags="r";this.mode=438;this.bufferSize=65536;o=o||{};var c=Object.keys(o);for(var s=0,u=c.length;s<u;s++){var a=c[s];this[a]=o[a]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void process.nextTick(function(){i._read()});t.open(this.path,this.flags,this.mode,function(t,e){if(t)return i.emit("error",t),void(i.readable=!1);i.fd=e,i.emit("open",e),i._read()})},WriteStream:function e(n,o){if(!(this instanceof e))return new e(n,o);r.call(this);this.path=n;this.fd=null;this.writable=!0;this.flags="w";this.encoding="binary";this.mode=438;this.bytesWritten=0;o=o||{};var i=Object.keys(o);for(var c=0,s=i.length;c<s;c++){var u=i[c];this[u]=o[u]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1;this._queue=[];null===this.fd&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}},29:function(t,e,n){e.asyncMap=n(30),e.bindActor=n(16),e.chain=n(31)},3:function(t,e){t.exports=require("util")},30:function(t,e){t.exports=function(){var t=Array.prototype.slice.call(arguments),e=t.shift()||[],n=t.pop();if("function"!=typeof n)throw new Error("No callback provided to asyncMap");if(!e)return n(null,[]);Array.isArray(e)||(e=[e]);var r=t.length,o=[],i=null,c=e.length,s=c*r;if(!s)return n(null,[]);function u(a){a&&!i&&(i=a);for(var l=arguments.length,f=1;f<l;f++)void 0!==arguments[f]&&(o[f-1]=(o[f-1]||[]).concat(arguments[f]));if(e.length>c){var p=e.slice(c);s+=(e.length-c)*r,c=e.length,process.nextTick(function(){p.forEach(function(e){t.forEach(function(t){t(e,u)})})})}0==--s&&n.apply(null,[i].concat(o))}e.forEach(function(e){t.forEach(function(t){t(e,u)})})}},31:function(t,e,n){t.exports=o;var r=n(16);function o(t,e){var n=[];!function i(c,s){return c>=s?e(null,n):(Array.isArray(t[c])&&(t[c]=r.apply(null,t[c].map(function(t){return t===o.first?n[0]:t===o.last?n[n.length-1]:t}))),t[c]?void t[c](function(t,r){if(t)return e(t,n);void 0!==r&&(n=n.concat(r)),i(c+1,s)}):i(c+1,s))}(0,t.length)}o.first={},o.last={}},32:function(t,e,n){!function(){var e;function n(t,r){var o=this instanceof n?this:e;if(o.reset(r),"string"==typeof t&&t.length>0&&o.hash(t),o!==this)return o}n.prototype.hash=function(t){var e,n,r,o,i;switch(i=t.length,this.len+=i,n=this.k1,r=0,this.rem){case 0:n^=i>r?65535&t.charCodeAt(r++):0;case 1:n^=i>r?(65535&t.charCodeAt(r++))<<8:0;case 2:n^=i>r?(65535&t.charCodeAt(r++))<<16:0;case 3:n^=i>r?(255&t.charCodeAt(r))<<24:0,n^=i>r?(65280&t.charCodeAt(r++))>>8:0}if(this.rem=i+this.rem&3,(i-=this.rem)>0){for(e=this.h1;e=5*(e=(e^=n=13715*(n=(n=11601*n+3432906752*(65535&n)&4294967295)<<15|n>>>17)+461832192*(65535&n)&4294967295)<<13|e>>>19)+3864292196&4294967295,!(r>=i);)n=65535&t.charCodeAt(r++)^(65535&t.charCodeAt(r++))<<8^(65535&t.charCodeAt(r++))<<16,n^=(255&(o=t.charCodeAt(r++)))<<24^(65280&o)>>8;switch(n=0,this.rem){case 3:n^=(65535&t.charCodeAt(r+2))<<16;case 2:n^=(65535&t.charCodeAt(r+1))<<8;case 1:n^=65535&t.charCodeAt(r)}this.h1=e}return this.k1=n,this},n.prototype.result=function(){var t,e;return t=this.k1,e=this.h1,t>0&&(e^=t=13715*(t=(t=11601*t+3432906752*(65535&t)&4294967295)<<15|t>>>17)+461832192*(65535&t)&4294967295),e^=this.len,e=51819*(e^=e>>>16)+2246770688*(65535&e)&4294967295,e=44597*(e^=e>>>13)+3266445312*(65535&e)&4294967295,(e^=e>>>16)>>>0},n.prototype.reset=function(t){return this.h1="number"==typeof t?t:0,this.rem=this.k1=this.len=0,this},e=new n,t.exports=n}()},33:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s(n(1)),o=s(n(62)),i=s(n(0)),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(5));function s(t){return t&&t.__esModule?t:{default:t}}const u=o.default.parse(r.default.readFileSync(i.default.resolve(c.InstallationDir()+"/dsm/config.ini"),"utf-8"));u.STEAM_DIR||(u.STEAM_DIR="steam"),u.STATUS_INTERVAL_MS||(u.STATUS_INTERVAL_MS=3e5),u.STATUS_INTERVAL_MS=parseInt(u.STATUS_INTERVAL_MS,10),e.default=u},4:function(t,e){t.exports=require("events")},5:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cleanPipeName=e.InstallationDir=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(8));e.InstallationDir=(()=>r.default.homedir()),e.cleanPipeName=(t=>"win32"===process.platform?"\\\\.\\pipe\\"+(t=(t=t.replace(/^\//,"")).replace(/\//g,"-")):t)},6:function(t,e){t.exports=require("stream")},62:function(t,e){e.parse=e.decode=function(t){var e={},n=e,o=null,i=/^\[([^\]]*)\]$|^([^=]+)(=(.*))?$/i;return t.split(/[\r\n]+/g).forEach(function(t,r,s){if(t&&!t.match(/^\s*[;#]/)){var u=t.match(i);if(u){if(void 0!==u[1])return o=c(u[1]),void(n=e[o]=e[o]||{});var a=c(u[2]),l=!u[3]||c(u[4]);switch(l){case"true":case"false":case"null":l=JSON.parse(l)}a.length>2&&"[]"===a.slice(-2)&&(a=a.substring(0,a.length-2),n[a]?Array.isArray(n[a])||(n[a]=[n[a]]):n[a]=[]),Array.isArray(n[a])?n[a].push(l):n[a]=l}}}),Object.keys(e).filter(function(t,n,o){if(!e[t]||"object"!=typeof e[t]||Array.isArray(e[t]))return!1;var i=r(t),c=e,s=i.pop(),u=s.replace(/\\\./g,".");return i.forEach(function(t,e,n){c[t]&&"object"==typeof c[t]||(c[t]={}),c=c[t]}),(c!==e||u!==s)&&(c[u]=e[t],!0)}).forEach(function(t,n,r){delete e[t]}),e},e.stringify=e.encode=function t(e,o){var c=[];var s="";"string"==typeof o?o={section:o,whitespace:!1}:(o=o||{}).whitespace=!0===o.whitespace;var u=o.whitespace?" = ":"=";Object.keys(e).forEach(function(t,r,o){var a=e[t];a&&Array.isArray(a)?a.forEach(function(e){s+=i(t+"[]")+u+i(e)+"\n"}):a&&"object"==typeof a?c.push(t):s+=i(t)+u+i(a)+n});o.section&&s.length&&(s="["+i(o.section)+"]"+n+s);c.forEach(function(i,c,u){var a=r(i).join("\\."),l=(o.section?o.section+".":"")+a,f=t(e[i],{section:l,whitespace:o.whitespace});s.length&&f.length&&(s+=n),s+=f});return s},e.safe=i,e.unsafe=c;var n="undefined"!=typeof process&&"win32"===process.platform?"\r\n":"\n";function r(t){return t.replace(/\1/g,"LITERAL\\1LITERAL").replace(/\\\./g,"").split(/\./).map(function(t){return t.replace(/\1/g,"\\.").replace(/\2LITERAL\\1LITERAL\2/g,"")})}function o(t){return'"'===t.charAt(0)&&'"'===t.slice(-1)||"'"===t.charAt(0)&&"'"===t.slice(-1)}function i(t){return"string"!=typeof t||t.match(/[=\r\n]/)||t.match(/^\[/)||t.length>1&&o(t)||t!==t.trim()?JSON.stringify(t):t.replace(/;/g,"\\;").replace(/#/g,"\\#")}function c(t,e){if(!o(t=(t||"").trim())){for(var n=!1,r="",i=0,c=t.length;i<c;i++){var s=t.charAt(i);if(n)-1!=="\\;#".indexOf(s)?r+=s:r+="\\"+s,n=!1;else{if(-1!==";#".indexOf(s))break;"\\"===s?n=!0:r+=s}}return n&&(r+="\\"),r.trim()}"'"===t.charAt(0)&&(t=t.substr(1,t.length-2));try{t=JSON.parse(t)}catch(t){}return t}},8:function(t,e){t.exports=require("os")},9:function(t,e){t.exports=require("net")},97:function(t,e){t.exports=require("node-pty")}});